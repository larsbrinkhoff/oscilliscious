#include <time.h>
#include <math.h>
#include "defs.h"

int main (void)
{
  int t0, i = 0, j = 0;

  /* SDL_AUDIODRIVER=alsa AUDIODEV=hw:2 */
  init ();

#if 1 /* Highest possible frequency.  Time divisor set to 50 us. */
  t0 = time (NULL);
  while (time (NULL) - t0 < 1) {
    draw_to (0, 32768 + 30000 * cos (i * 3.141592653589793));
    i++;
  }
#endif

#if 1 /* Single sine wave phase shift. */
  t0 = time (NULL);
  while (time (NULL) - t0 < 10) {
    draw_blank (0, 30000 * (1 + sin (j / 100.0)));
    for (i = 0; i <= 65535; i += 300)
      draw_to (i, 30000 * (1 + sin (i / 10000.0 + j / 100.0)));
    draw_blank (65535, 30000 * (1 + sin (65535 / 10000.0 + j / 100.0)));
    j++;
  }
#endif

#if 1 /* Sine wave varying period. */
  t0 = time (NULL);
  while (time (NULL) - t0 < 10) {
    draw_blank (0, 30000 * (1 + sin (0)));
    for (i = 0; i <= 65535; i += 300)
      draw_to (i, 30000 * (1 + sin (i / (10000.0 + 7000 * sin (j / 20.0)))));
    draw_blank (65535, 30000 * (1 + sin (65535 / (10000.0 + 7000 * sin (j / 20.0)))));
    j++;
  }
#endif

#if 1 /* Lissajous. */
  t0 = time (NULL);
  while (time (NULL) - t0 < 10) {
    draw_to (32000 * (1 + cos (i / 20010.0)),
             32000 * (1 + sin (i / 10000.0)));
    i += 1000;
  }
#endif

#if 1 /* Rotating square and line. */
  t0 = time (NULL);
  while (time (NULL) - t0 < 10) {
    int dx = 32760 * cos (i / -20000.0);
    int dy = 32760 * sin (i / -20000.0);
    draw_line (32768 + dx, 32768 + dy, 32768 + dy, 32768 - dx);
    draw_line (32768 + dy, 32768 - dx, 32768 - dx, 32768 - dy);
    draw_line (32768 - dx, 32768 - dy, 32768 - dy, 32768 + dx);
    draw_line (32768 - dy, 32768 + dx, 32768 + dx, 32768 + dy);
    draw_line (32768, 32728,
               32768 + 30000 * cos (i / 5000.0),
               32768 + 30000 * sin (i / 5000.0));
    i += 200;
  }
#endif

#if 1
  static int v0[8][3] = {
    { +1,+1,+1 }, { +1,-1,+1 }, { -1,-1,+1 }, { -1,+1,+1 },
    { +1,+1,-1 }, { +1,-1,-1 }, { -1,-1,-1 }, { -1,+1,-1 },
  };
  static double v1[8][3];
  t0 = time (NULL);
  while (time (NULL) - t0 < 10) {
    double cosa = cos (i / -20000.0);
    double sina = sin (i / -20000.0);
    double cosb = cos (j /  20000.0);
    double sinb = sin (j /  20000.0);
    int k;

    for (k = 0; k < 8; k++) {
      v1[k][0] = (v0[k][0] * cosa - v0[k][1] * sina) * cosb
        - v0[k][2] * sinb;
      v1[k][1] = v0[k][1] * cosa + v0[k][0] * sina;
      v1[k][2] = (v0[k][0] * cosa - v0[k][1] * sina) * sinb
        - v0[k][2] * cosb;
    }

    draw_line (32768 + 100000 * v1[0][0] / (10 + v1[0][2]),
               32768 + 100000 * v1[0][1] / (10 + v1[0][2]),
               32768 + 100000 * v1[1][0] / (10 + v1[1][2]),
               32768 + 100000 * v1[1][1] / (10 + v1[1][2]));
    draw_line (32768 + 100000 * v1[1][0] / (10 + v1[1][2]),
               32768 + 100000 * v1[1][1] / (10 + v1[1][2]),
               32768 + 100000 * v1[2][0] / (10 + v1[2][2]),
               32768 + 100000 * v1[2][1] / (10 + v1[2][2]));
    draw_line (32768 + 100000 * v1[2][0] / (10 + v1[2][2]),
               32768 + 100000 * v1[2][1] / (10 + v1[2][2]),
               32768 + 100000 * v1[3][0] / (10 + v1[3][2]),
               32768 + 100000 * v1[3][1] / (10 + v1[3][2]));
    draw_line (32768 + 100000 * v1[3][0] / (10 + v1[3][2]),
               32768 + 100000 * v1[3][1] / (10 + v1[3][2]),
               32768 + 100000 * v1[0][0] / (10 + v1[0][2]),
               32768 + 100000 * v1[0][1] / (10 + v1[0][2]));

    draw_line (32768 + 100000 * v1[0][0] / (10 + v1[0][2]),
               32768 + 100000 * v1[0][1] / (10 + v1[0][2]),
               32768 + 100000 * v1[4][0] / (10 + v1[4][2]),
               32768 + 100000 * v1[4][1] / (10 + v1[4][2]));
    draw_line (32768 + 100000 * v1[1][0] / (10 + v1[1][2]),
               32768 + 100000 * v1[1][1] / (10 + v1[1][2]),
               32768 + 100000 * v1[5][0] / (10 + v1[5][2]),
               32768 + 100000 * v1[5][1] / (10 + v1[5][2]));
    draw_line (32768 + 100000 * v1[2][0] / (10 + v1[2][2]),
               32768 + 100000 * v1[2][1] / (10 + v1[2][2]),
               32768 + 100000 * v1[6][0] / (10 + v1[6][2]),
               32768 + 100000 * v1[6][1] / (10 + v1[6][2]));
    draw_line (32768 + 100000 * v1[3][0] / (10 + v1[3][2]),
               32768 + 100000 * v1[3][1] / (10 + v1[3][2]),
               32768 + 100000 * v1[7][0] / (10 + v1[7][2]),
               32768 + 100000 * v1[7][1] / (10 + v1[7][2]));

    draw_line (32768 + 100000 * v1[4][0] / (10 + v1[4][2]),
               32768 + 100000 * v1[4][1] / (10 + v1[4][2]),
               32768 + 100000 * v1[5][0] / (10 + v1[5][2]),
               32768 + 100000 * v1[5][1] / (10 + v1[5][2]));
    draw_line (32768 + 100000 * v1[5][0] / (10 + v1[5][2]),
               32768 + 100000 * v1[5][1] / (10 + v1[5][2]),
               32768 + 100000 * v1[6][0] / (10 + v1[6][2]),
               32768 + 100000 * v1[6][1] / (10 + v1[6][2]));
    draw_line (32768 + 100000 * v1[6][0] / (10 + v1[6][2]),
               32768 + 100000 * v1[6][1] / (10 + v1[6][2]),
               32768 + 100000 * v1[7][0] / (10 + v1[7][2]),
               32768 + 100000 * v1[7][1] / (10 + v1[7][2]));
    draw_line (32768 + 100000 * v1[7][0] / (10 + v1[7][2]),
               32768 + 100000 * v1[7][1] / (10 + v1[7][2]),
               32768 + 100000 * v1[4][0] / (10 + v1[4][2]),
               32768 + 100000 * v1[4][1] / (10 + v1[4][2]));

    i += 600;
    j += 50;
  }
#endif

#if 1 /* Lorenz attractor. */
  {
    float x, y, z, dx, dy, dz;
    x = y = z = 1;
    t0 = time (NULL);
    while (time (NULL) - t0 < 10) {
      draw_to (32768 + 1200 * x, 32768 + 1200 * y);
      dx = 10 * (y - x);
      dy = x * (28 - z) - y;
      dz = x * y - 8.0/3.0 * z;
      x += .010 * dx;
      y += .010 * dy;
      z += .010 * dz;
    }
  }
#endif

#if 1 /* Munching squares. */
  {
    long long x, y, z, v = 0;
    t0 = time (NULL);
    while (time (NULL) - t0 < 10) {
      x = 01001002LL;
      x += v;
      x &= 0777777777777LL;
      v = x;
      z = y & 0777777LL;
      y >>= 18;
      y |= (x & 0777777LL) << 18;
      x >>= 18;
      x |= z << 18;
      x ^= v;
      draw_to (x >> 20, y >> 20);
    }
  }
#endif

  return 0;
}
